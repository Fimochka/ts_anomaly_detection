### Автоматизированный поиск аномалий во временных рядах 

Поиск аномалий с помощью разных встроенных подходов и методов ("из коробки").

Цель состоит в том чтобы создать сервис, в котором можно будет легко:
- подключить источники данных (CH, Postgresql, hive, etc)
- добавить временные ряды (метрики) через единый удобный интерфейс
- для любой метрики выбрать алгоритм и выбрать предиктивную модель, которая будет обучаться на исторических данных с учетом всех особенностей (тренд, сезонность), добавить внешние факторы (если нужно)
- получить точечный прогноз и доверительные интервалы + отчет о метрике (насколько ожидаемые значения метрики соответствуют факту с уровнем значимости и статвыводами)
- также можно будет выбрать преобразования для временных рядов (Бокса-Кокса и прочее)
- можно настроить оповещения и интеграцию с внешними системами (почта, слак, mattermost, etc)
- можно задать периодичность (за какой период данные агрегируются)
- можно выбрать (добавить) шаблон текста оповещений в зависимости от типа метрик (для технических метрик одно, для продуктовых/бизнесовых - другое)

Основная идея такого сервиса — коробочное решение по настройке «умного» мониторинга продуктовых (а возможно и технических тоже) метрик, с которым удобно работать и относительно просто настраивать. Также прикладное применение — оценить метрики после крупного релиза приложения (как пример), когда раскатка сразу произошла на 100% аудитории. При этом необязательно будет для решения задачи разворачивать условную графану, т. к. все дашборды будут в одном месте. 

Задача поиска аномалий решается много где, но на практике это всегда очень нетривиально и много инструментов задействовано. Хочется создать доступный и понятный сервис для решения такой задачи, который избавит от большой части рутинных работ по настройке мониторинга и инфраструктуры.

При этом решение должно будет работать для временных рядов самой разной природы (продуктовые метрики, данные оборудования, технические метрики и т.д.)

### Airflow

1. etl

Периодически:
- загружает данные из хранилища (список источников будет пополняться)
- осуществляет предобработку (фильтрация, агрегация, преобразование и т.д.)
- сохраняет в локальную БД

2. anomaly_detection

Периодически:
- выгружает данные из внутренней БД
- обучает модели (IQRAnomalyDetector/ARIMA/LSTM/etc - список доступных решений будет пополняться)
- сохраняет доверительные интервалы в локальную БД

Оба дага читают свой файл с настройками.

Параметры подключения к БД указываются в airflow (в конфиги передаем значение параметра connection_id для каждой метрики)

### Dashboards

Можно для MVP использовать какую-то готовую BI-систему, в которой мы просто будем отображать графики

Внешний вид графиков должен включать:
- сам ряд
- доверительные интервалы
- метки точек, в которых у нас аномалии

Виды аномалий:
- точечные (одно значение ряда сильно отличается от других)
- интервальные (?) - когда сразу несколько подряд значений являются "нетипичными" для данного ряда

Ссылки:
1. обзор методов поиска аномалий на основе обучения без учителя - https://www.mdpi.com/1424-8220/23/5/2844
2. causal inference with synthetic control - https://www.google.ru/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwisz_bXxJOBAxUzcvEDHX0IBLAQFnoECBkQAQ&url=https%3A%2F%2Ftowardsdatascience.com%2Fcausal-inference-with-synthetic-control-in-python-4a79ee636325&usg=AOvVaw1RIQanegkgbVpqwsF8r3PT&opi=89978449
